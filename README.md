# Движок структурного автомата
<p> Структурным автоматом назовём недетерминированный конечный автомат с несколькими активными состояниями с особым видом состояния "Точка сборки". Переход автомата из точки сборки в следующие состояния происходит не по команде, а тогда, когда осуществлён переход в точку сборки изо всех состояний, имеющих выход в эту точку сборки.
<p> Порядок установки и работы:
<p>1. Установить на http-сервере поддержку sqlite и поддержку php- или python- скриптов.
<p>2. Поместить все файлы из этого репозитория в папку folder на http-сервер.
<p>3. SQLite-база fsmx.db содержит пример структурного автомата и имеет три таблицы:
<p>fsmx 	– таблица переходов с колонками state (номер состояния), command (номер команды) и nextState (номер следующего состояния).
<p>roleStates	– таблица связки ролей с состояниями с колонками state (номер состояния) и role (номер роли). К точкам сборки и финальному состоянию роли не привязываются.
<p>activeStates	– таблица	с колонкой activeState, содержащая перечень номеров активных состояний структурного автомата.
<p>В базу добавлены представления:
<p>а)	Число входов у точки сборки: 
<p>CREATE VIEW gatecnt(gate, cnt) as select nextstate gate, count(nextstate) cnt from fsmx  where nextState in (select f2.state from fsmx f2 where command = -1) group by nextState
<p>Признак точки сборки: command = -1.
<p>б)	Число повторяющихся активных состояний (используется для активации точки сборки)
<p>CREATE VIEW currentgatecnt(state,cnt) as select activeState, count(activeState) c from activeStates group by activeState having c >1
<p>4. Диаграмма переходов для примера структурного автомата в базе имеет вид:

![s](https://github.com/GrigoryevV/StructuralStateMachine/blob/main/fsmx.png)

<p>5. Запустить движок. Для локального  http-сервера:
<p>localhost/folder/fsmx.py либо либо localhost/folder/fsmx.php
<p>Веб-страницы для PHP и Python несколько отличаются. В PHP используются таблицы. Смотреть в PHP удобнее.
<p>В PHP-версии при принудительном открытии веб-страницы (путём предачи GET-параметров в URL) для неактивного состояния или состояния не привязанного к роли внизу страницы отсутсвуют ссылки для перехода в другие состояния согласно диаграмме перехода автомата.
<p>6. Следуя диаграмме переходов, перевести структурный автомат в конечное состояние, равное 0.
<p>7. Перед последующими запусками движка следует установить структурный автомат в начальное состояние, равное 20 с помощью запуска скрипта:
<p>localhost/folder/newActiveStates.py y либо либо localhost/folder/newActiveStates.php
<p>8. SQLite-база fsmx1.db содержит ещё один пример структурного автомата. Диаграмма переходов имеет вид:

![s](https://github.com/GrigoryevV/StructuralStateMachine/blob/main/fsmx1.png)

<p>9. Для привязки php- или python- скрипта к новому структурному автомату следует просто заменить во всех скриптах имя файла базы данных. В нашем случае следует заменить строку "fsmx.db" на строку  "fsmx1.db".
<p>10. Для привязки php- или python- скрипта к новому рисунку диаграммы структурного автомата следует просто заменить во всех скриптах имя файла рисунка. В нашем случае следует заменить строку "fsmx.png" на строку  "fsmx1.png".
<p>11. Следует также в скриптах newActiveStates.* установить правильное начальное состояние автомата. Для автомата из базы fsmx1.db оно равно 1.




